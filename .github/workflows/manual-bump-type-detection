name: Manual Label Detection
description: "Determines the new version tag based on PR labels (major, minor, patch) and outputs the label."

on:
  workflow_dispatch:

jobs:
  get-pr-label:
    runs-on: ubuntu-latest
    outputs:
      PR_LABEL: ${{ steps.set-label.outputs.PR_LABEL }}
    steps:
      - name: Find PR and Get Labels
        id: set-label
        run: |
          PR_NUMBER=$(curl -s -H "Authorization: Bearer ${{ secrets.GH_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/pulls?head=${{ github.repository_owner }}:${GITHUB_REF_NAME}" \
            | jq '.[0].number')

          if [[ -n "$PR_NUMBER" && "$PR_NUMBER" != "null" ]]; then
            LABELS=$(curl -s -H "Authorization: Bearer ${{ secrets.GH_TOKEN }}" \
              "https://api.github.com/repos/${{ github.repository }}/issues/$PR_NUMBER/labels" \
              | jq -r '.[].name')

            if echo "$LABELS" | grep -q "major"; then
              PR_LABEL="major"
            elif echo "$LABELS" | grep -q "minor"; then
              PR_LABEL="minor"
            elif echo "$LABELS" | grep -q "patch"; then
              PR_LABEL="patch"
            else
              PR_LABEL="patch"
            fi
          else
            PR_LABEL="patch"
          fi

          echo "PR_LABEL=$PR_LABEL" >> $GITHUB_ENV
          echo "PR_LABEL=$PR_LABEL" >> $GITHUB_OUTPUT

      - name: Debug Output
        run: |
          echo "PR Label is: $PR_LABEL"
